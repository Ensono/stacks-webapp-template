############################################################################################################
# desc: Runs npm scripts for a node project bootstrapped by the scaffolding-cli
# return:
# inputs:
#    - working_directory
#    - target_container (see scaffolding-cli)
#    - npm_scripts: a list of scripts to run, e.g. [build, test]
#    - env_vars: optional run time environment variables
# pre-reqs: Project image is built and pushed to registry
############################################################################################################

parameters:
  working_directory: ''
  target_container: ''
  npm_scripts: []
  env_vars: {}

steps:
    - ${{ each script in parameters.npm_scripts }}:
        - bash: |
            npm run ${{ script }}
          target:
            container: ${{ parameters.target_container }}
          displayName: "scaffolding-cli: Project npm run ${{ script }}"
          workingDirectory: ${{ parameters.working_directory }}
          env:
            ${{ each var in parameters.env_vars }}:
              ${{ var.key }}: ${{ var.value }}
