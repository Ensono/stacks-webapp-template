parameters:
  pool:
    vmImage: "ubuntu-latest"
  # Docker Config
  build_container_image: false
  run_container_image: false
  docker_build_additional_args: ""
  docker_run_additional_args: []
  docker_workdir: ""
  docker_imagename: ""
  docker_containerregistryname: ""
  docker_tag_args: ""
  # Build File Output
  build_file: false
  build_on_server: false
  build_file_path: ""
  build_file_artefact: ""

steps:
  # Build Docker Image
  - ${{ if eq(parameters.build_container_image, true) }}:
      - template: ../steps/build-container-image-no-push.yml
        parameters:
          working_directory: ${{ parameters.docker_workdir }}
          docker_build_additional_args: ${{ parameters.docker_build_additional_args }}
          docker_tag_args: ${{ parameters.docker_tag_args }}

  # Run Docker Image
  - ${{ if eq(parameters.run_container_image, true) }}:
      - ${{ each arg in parameters.docker_run_additional_args }}:
        - template: ../steps/run-container-image.yml
          parameters:
            working_directory: ${{ parameters.docker_workdir }}
            docker_run_additional_args: ${{ arg }}
            docker_imagename: ${{ parameters.docker_imagename }}
            docker_containerregistryname: ${{ parameters.docker_containerregistryname }}
