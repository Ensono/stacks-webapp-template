#
# Steps consumer driven contract testing with Pact.
#

parameters:
  versionSpec: ''
  build_number: ''
  workingDirectory: ''

steps:
  # Run Pact contract tests
  - script: npm run test:pact
    displayName: 'Run pact tests'
    workingDirectory: ${{ parameters.workingDirectory }}

  # Publish contracts to Pact broker
  - script: npm run test:pact-publish
    displayName: 'Publish pact tests'
    workingDirectory: ${{ parameters.workingDirectory }}
    env:
      BUILD_NUMBER: ${{ parameters.build_number }}
      SOURCE_BRANCH_NAME: $(build.SourceBranchName)
      PACT_BROKER: $(PACT_BROKER)
      PACT_BEARER_TOKEN: $(PACT_BEARER_TOKEN)
