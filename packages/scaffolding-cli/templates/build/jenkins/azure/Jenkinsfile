pipeline {
    agent none
    stages {
        stage('CI') {
            agent {
                docker {
                        image 'amidostacks/ci-k8s:0.0.7'
                      }
            }
            steps {
                sh '''
                  cd ${WORKSPACE}/packages/scaffolding-cli/templates/src/ssr
                  npm install
                  npm run test
                '''
                sh '''
                  cd ${WORKSPACE}/packages/scaffolding-cli/templates/src/ssr
                  docker build . -t test:${BUILD_NUMBER}
                '''
            }
        }
    }
}
