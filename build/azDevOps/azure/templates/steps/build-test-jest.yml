#
# Steps for building and testing using Jest. See jobs defined in install-build-test.yml
#

parameters:
  versionSpec: ''

steps:
  - checkout: self

  - task: Npm@1
    displayName: 'Build: Install Dev Dependencies'
    inputs:
      command: 'install' # Options: install, publish, custom
      verbose: false
      customRegistry: 'useNpmrc'

  # Run tests with Jest
  - script: npm run validate
    displayName: 'Run linting'

  # Run tests with Jest
  - script: npm run test
    displayName: 'Run tests'

  # Publish CI test results
  - task: PublishTestResults@2
    inputs:
      testRunner: JUnit
      testResultsFiles: '**/junit-test-report.xml'
      testRunTitle: 'Jest Tests'
    displayName: 'Publish test results'
    condition: succeededOrFailed()

  # Publish the code coverage results
  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: '**/cobertura-coverage.xml'
